!function(){customElements.define("back-button",class extends HTMLElement{constructor(){super(),this._shadow=this.attachShadow({mode:"open"});let t=document.createElement("button");t.onclick=()=>{controller.openPage("homePage")},t.classList.add("backButton"),t.innerHTML='\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <circle cx="12" cy="12" r="10"></circle>\n                <polyline points="12 8 8 12 12 16"></polyline>\n                <line x1="16" y1="12" x2="8" y2="12"></line>\n            </svg>\n        ',this._shadow.appendChild(t)}});var t=class{constructor(t,e,n){this.name=t,this.price=e,this.amount=n}},e=class{constructor(e,n,a,o,c,s,i){this._id=e,this._category=n,this._amount=a,this._location=o,this._date=new Date(c),this._note=s,this._items=[];for(let r=0;r<i.length;r++)this._items.push(new t(i[r].name,i[r].price,i[r].amount))}get id(){return this._id}get category(){return this._category}get amount(){return parseFloat((this._amount/100).toFixed(2))}amountString(){return"$"+(this._amount/100).toFixed(2)}get location(){return this._location}get date(){return this._date}dateString(t){let e={};return"long"===t?e={year:"numeric",month:"long",day:"numeric",weekday:"long"}:"short"===t&&(e={year:"numeric",month:"short",day:"numeric"}),this._date.toLocaleDateString("en-US",e)}get note(){return this._note}},n=class{constructor(t,n,a,o,c,s){this._id=t,this._name=n,this._bills=a,this._income=o,this._categories=c,this._transactions=[];for(let i=0;i<s.length;i++)this._transactions.push(new e(s[i]._id,s[i].category,s[i].amount,s[i].location,s[i].date,s[i].note,s[i].items))}get id(){return this._id}get bills(){return this._bills}addBill(t,e){this._bills.push({name:t,amount:e}),state.homePage.newData=!0}get income(){return this._income}addIncome(t,e){this._income.push({name:t,amount:e}),state.homePage.newData=!0}get categories(){return this._categories}addCategory(t){this._categories.push(t),state.homePage.newData=!0}get transactions(){return this._transactions}addTransaction(t){this._transactions.push(new e(t._id,t.category,t.amount,t.location,new Date(t.date),t.note,t.items)),state.homePage.newData=!0}removeTransaction(t){for(let e=0;e<this._transactions.length;e++)if(this._transactions[e].id===t){this._transactions.splice(e,1);break}state.homePage.newData=!0}sortTransactions(t){this._transactions.sort((e,n)=>e[t]>n[t]?-1:1)}discretionary(){let t=0,e=0;for(let n=0;n<this._bills.length;n++)t+=this._bills[n].amount;for(let n=0;n<this._income.length;n++)e+=this._income[n].amount;return parseFloat(((e-t)/100).toFixed(2))}remainingDiscretionary(){let t=this.discretionary();for(let e=0;e<this._transactions.length;e++)"Discretionary"===this._transactions[e].category&&(t-=this._transactions[e].amount);return t}incomeTotal(){let t=0;for(let e=0;e<this._income.length;e++)t+=this._income[e].amount;return parseFloat((t/100).toFixed(2))}billTotal(){let t=0;for(let e=0;e<this._bills.length;e++)t+=this._bills[e].amount;return parseFloat((t/100).toFixed(2))}};var a={display:function(){if(null===state.user){let t=new Date;t.setDate(0),t.setHours(0,0,0,0),fetch("/finance/user",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({from:t,to:new Date})}).then(t=>t.json()).then(async t=>{state.user=new class{constructor(t,e,a){this._id=t,this._accounts=e,this._account=void 0===a?{}:new n(a._id,a.name,a.bills,a.income,a.categories,a.transactions)}get account(){return this._account}addAccount(t){this._accounts.push(t)}changeAccount(t){if("string"==typeof t)return fetch("/finance/account/"+t).then(t=>t.json()).then(t=>{this._account=new n(t.account._id,t.account.name,t.account.bills,t.account.income,t.account.categories,t.transactions),state.homePage.newData=!0}).catch(t=>{});this._account=t}get accounts(){return this._accounts}}(t._id,t.accounts,t.account),state.homePage.newData=!0,0===t.accounts.length?controller.openPage("createAccountPage"):(await state.user.changeAccount(state.user.accounts[0]),this.populateTransactions(),this.populateStats())}).catch(t=>{}),document.getElementById("createAccountBtn").onclick=()=>{controller.openPage("createAccountPage")},document.getElementById("createTransactionBtn").onclick=()=>{controller.openPage("createTransactionPage")},document.getElementById("createCategoryBtn").onclick=()=>{controller.openPage("createCategoryPage")},document.getElementById("createBillBtn").onclick=()=>{controller.openPage("createBillPage")},document.getElementById("createIncomeBtn").onclick=()=>{controller.openPage("createIncomePage")}}else!0===state.homePage.newData&&(this.populateTransactions(),this.populateStats())},populateTransactions:function(){let t=document.getElementById("transactionsBody");for(;t.children.length>0;)t.removeChild(t.firstChild);state.user.account.sortTransactions("date");for(let e=0;e<state.user.account.transactions.length;e++){let n=document.createElement("tr");n.onclick=()=>{controller.openPage("transactionPage",state.user.account.transactions[e])},n.classList.add("transaction");let a=document.createElement("td");a.innerText=state.user.account.transactions[e].dateString("short"),n.appendChild(a);let o=document.createElement("td");o.innerText=state.user.account.transactions[e].category,n.appendChild(o);let c=document.createElement("td");c.innerText=state.user.account.transactions[e].location,n.appendChild(c);let s=document.createElement("td");s.innerText=state.user.account.transactions[e].amountString(),n.appendChild(s),t.appendChild(n)}state.homePage.newData=!1},populateStats:function(){document.getElementById("totalDiscretionary").innerText=state.user.account.discretionary(),document.getElementById("remainingDiscretionary").innerText=state.user.account.remainingDiscretionary(),document.getElementById("totalIncome").innerText=state.user.account.incomeTotal(),document.getElementById("totalBills").innerText=state.user.account.billTotal()}};var o={display:function(){document.getElementById("createAccountForm").onsubmit=()=>{this.submit()}},submit:function(){event.preventDefault(),fetch("/finance/account",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({name:document.getElementById("createAccountName").value})}).then(t=>t.json()).then(t=>{state.user.addAccount(t._id),state.user.changeAccount(new n(t._id,t.name,t.bills,t.income,t.categories,[])),controller.openPage("homePage")}).catch(t=>{})}};var c={display:function(){if(document.getElementById("createTransactionForm").onsubmit=()=>{this.submit()},document.getElementById("createTransactionAccount"),!0===state.createTransactionPage.newCategories){let t=document.getElementById("createTransactionCategory");for(;t.children.length>0;)t.removeChild(t.firstChild);for(let e=0;e<state.user.account.bills.length;e++){let n=document.createElement("option");n.innerText=state.user.account.bills[e].name,n.value=state.user.account.bills[e].name,t.appendChild(n)}for(let e=0;e<state.user.account.income.length;e++){let n=document.createElement("option");n.innerText=state.user.account.income[e].name,n.value=state.user.account.income[e].name,t.appendChild(n)}for(let e=0;e<state.user.account.categories.length;e++){let n=document.createElement("option");n.innerText=state.user.account.categories[e],n.value=state.user.account.categories[e],t.appendChild(n)}state.createTransactionPage.newCategories}},submit:function(){event.preventDefault();let t={account:state.user.account.id,category:document.getElementById("createTransactionCategory").value,amount:document.getElementById("createTransactionAmount").value,location:document.getElementById("createTransactionLocation").value,date:document.getElementById("createTransactionDate").valueAsDate,note:document.getElementById("createTransactionNote").value};t.amount*=100,fetch("/finance/transaction",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>t.json()).then(t=>{state.user.account.addTransaction(t),controller.openPage("homePage")}).catch(t=>{})}};var s={display:function(){document.getElementById("createCategoryForm").onsubmit=()=>{this.submit()}},submit:function(){event.preventDefault();let t={account:state.user.account.id,name:document.getElementById("createCategoryName").value};fetch("/finance/category",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>t.json()).then(e=>{state.user.account.addCategory(t.name),controller.openPage("homePage")}).catch(t=>{})}};var i={display:function(){document.getElementById("createBillForm").onsubmit=()=>{this.submit()}},submit:function(){event.preventDefault();let t={account:state.user.account.id,name:document.getElementById("createBillName").value,amount:document.getElementById("createBillAmount").value};t.amount=parseInt(100*t.amount),fetch("/finance/bill",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>t.json()).then(e=>{if("string"==typeof e)throw e;state.user.account.addBill(t.name,t.amount),controller.openPage("homePage")}).catch(t=>{})}};var r={display:function(){document.getElementById("createIncomeForm").onsubmit=()=>{this.submit()}},submit:function(){event.preventDefault();let t={account:state.user.account.id,name:document.getElementById("createIncomeName").value,amount:document.getElementById("createIncomeAmount").value};t.amount=parseInt(100*t.amount),fetch("/finance/income",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).then(t=>t.json()).then(e=>{if("string"==typeof e)throw e;state.user.account.addIncome(t.name,t.amount),controller.openPage("homePage")}).catch(t=>{})}};var l={display:function(t){document.getElementById("transactionDate").innerText=t.dateString("long"),document.getElementById("transactionLocation").innerText=t.location,document.getElementById("transactionCategory").innerText=t.category,document.getElementById("transactionAmount").innerText=t.amountString(),document.getElementById("transactionNote").innerText=t.note,document.getElementById("deleteTransaction").onclick=()=>{this.delete(t)}},delete:function(t){fetch("/finance/transaction/"+t.id,{method:"delete"}).then(t=>t.json()).then(e=>{if("string"==typeof e)throw e;state.user.account.removeTransaction(t.id),controller.openPage("homePage")}).catch(t=>{})}};controller={openPage:function(t,e){let n=document.querySelectorAll(".page");for(let a=0;a<n.length;a++)n[a].style.display="none";switch(document.getElementById(t).style.display="flex",t){case"homePage":a.display();break;case"createAccountPage":o.display();break;case"createTransactionPage":c.display();break;case"createCategoryPage":s.display();break;case"createBillPage":i.display();break;case"createIncomePage":r.display();break;case"transactionPage":l.display(e)}}},state={user:null,homePage:{newData:!0},createTransactionPage:{newCategories:!0}},a.display()}();