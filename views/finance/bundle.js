!function(){customElements.define("back-button",class extends HTMLElement{constructor(){super(),this._shadow=this.attachShadow({mode:"open"});let e=document.createElement("button");e.onclick=()=>{controller.openPage("homePage")},e.classList.add("backButton"),e.innerHTML='\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <circle cx="12" cy="12" r="10"></circle>\n                <polyline points="12 8 8 12 12 16"></polyline>\n                <line x1="16" y1="12" x2="8" y2="12"></line>\n            </svg>\n        ',this._shadow.appendChild(e)}});var e=class{constructor(e,t,n){this.name=e,this.price=t,this.amount=n}},t=class{constructor(t,n,a,o,c,s,i){this._id=t,this._category=n,this._amount=a,this._location=o,this._date=new Date(c),this._note=s,this._items=[];for(let r=0;r<i.length;r++)this._items.push(new e(i[r].name,i[r].price,i[r].amount))}get id(){return this._id}get category(){return this._category}get amount(){return parseFloat((this._amount/100).toFixed(2))}amountString(){return"$"+(this._amount/100).toFixed(2)}get location(){return this._location}get date(){return this._date}dateString(e){let t={};return"long"===e?t={year:"numeric",month:"long",day:"numeric",weekday:"long"}:"short"===e&&(t={year:"numeric",month:"short",day:"numeric"}),this._date.toLocaleDateString("en-US",t)}get note(){return this._note}},n=class{constructor(e,n,a,o,c,s,i){this._id=e,this._name=n,this._bills=a,this._income=o,this._categories=c,this._balance=s,this._transactions=[];for(let r=0;r<i.length;r++)this._transactions.push(new t(i[r]._id,i[r].category,i[r].amount,i[r].location,i[r].date,i[r].note,i[r].items))}get id(){return this._id}get name(){return this._name}get bills(){let e=[];for(let t=0;t<this._bills.length;t++)e.push({name:this._bills[t].name,amount:parseFloat((this._bills[t].amount/100).toFixed(2))});return e}addBill(e,t){this._bills.push({name:e,amount:t}),state.homePage.newData=!0}get income(){let e=[];for(let t=0;t<this._income.length;t++)e.push({name:this._income[t].name,amount:parseFloat((this._income[t].amount/100).toFixed(2))});return e}addIncome(e,t){this._income.push({name:e,amount:t}),state.homePage.newData=!0}get categories(){return this._categories}addCategory(e){this._categories.push(e),state.homePage.newData=!0}get transactions(){return this._transactions}removeCategory(e,t){switch(t){case"category":this._categories.splice(this._categories.indexOf(e),1);break;case"income":for(let t=0;t<this._income.length;t++)if(e===this._income[t].name){this._income.splice(t,1);break}break;case"bills":for(let t=0;t<this._bills.length;t++)if(e===this._bills[t].name){this._bills.splice(t,1);break}}state.homePage.newData=!0}get balance(){return parseFloat((this._balance/100).toFixed(2))}addTransaction(e){this._transactions.push(new t(e._id,e.category,e.amount,e.location,new Date(e.date),e.note,e.items)),state.homePage.newData=!0}removeTransaction(e){for(let t=0;t<this._transactions.length;t++)if(this._transactions[t].id===e){this._transactions.splice(t,1);break}state.homePage.newData=!0}sortTransactions(e){this._transactions.sort((t,n)=>t[e]>n[e]?-1:1)}discretionary(){let e=0,t=0;for(let n=0;n<this._bills.length;n++)e+=this._bills[n].amount;for(let n=0;n<this._income.length;n++)t+=this._income[n].amount;return parseFloat(((t-e)/100).toFixed(2))}remainingDiscretionary(){let e=this.discretionary();for(let t=0;t<this._transactions.length;t++)"Discretionary"===this._transactions[t].category&&(e-=this._transactions[t].amount);return e}incomeTotal(){let e=0;for(let t=0;t<this._income.length;t++)e+=this._income[t].amount;return parseFloat((e/100).toFixed(2))}billTotal(){let e=0;for(let t=0;t<this._bills.length;t++)e+=this._bills[t].amount;return parseFloat((e/100).toFixed(2))}},a=class{constructor(e,t,a){this._id=e,this._accounts=t,this._account=void 0===a?{}:new n(a._id,a.name,a.bills,a.income,a.categories,a.balance,a.transactions)}get account(){return this._account}addAccount(e){this._accounts.push(e)}changeAccount(e){if("string"==typeof e)return fetch("/finance/account/"+e).then(e=>e.json()).then(e=>{this._account=new n(e.account._id,e.account.name,e.account.bills,e.account.income,e.account.categories,e.account.balance,e.transactions),state.homePage.newData=!0,controller.openPage("homePage")}).catch(e=>{});this._account=e}get accounts(){return this._accounts}};var o={display:function(){if(null===state.user){let e=new Date;e.setDate(0),e.setHours(0,0,0,0),fetch("/finance/user",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({from:e,to:new Date})}).then(e=>e.json()).then(async e=>{state.homePage.newData=!0,0===e.accounts.length?(state.user=new a(e._id,e.accounts),controller.openPage("createAccountPage")):(state.user=new a(e._id,e.accounts,e.account),this.populateTransactions(),this.populateStats(),this.populateIncome(),this.populateBills())}).catch(e=>{}),document.getElementById("deleteAccount").onclick=()=>{this.deleteAccount()},document.getElementById("createAccountBtn").onclick=()=>{controller.openPage("createAccountPage")},document.getElementById("createTransactionBtn").onclick=()=>{controller.openPage("createTransactionPage")},document.getElementById("createCategoryBtn").onclick=()=>{controller.openPage("createCategoryPage")},document.getElementById("createBillBtn").onclick=()=>{controller.openPage("createBillPage")},document.getElementById("createIncomeBtn").onclick=()=>{controller.openPage("createIncomePage")}}else!0===state.homePage.newData&&(this.populateTransactions(),this.populateStats(),this.populateIncome(),this.populateBills())},populateTransactions:function(){let e=document.getElementById("transactionsBody");for(;e.children.length>0;)e.removeChild(e.firstChild);state.user.account.sortTransactions("date");for(let t=0;t<state.user.account.transactions.length;t++){let n=document.createElement("tr");n.onclick=()=>{controller.openPage("transactionPage",state.user.account.transactions[t])},n.classList.add("transaction");let a=document.createElement("td");a.innerText=state.user.account.transactions[t].dateString("short"),a.classList.add("mainTd"),n.appendChild(a);let o=document.createElement("td");o.innerText=state.user.account.transactions[t].category,o.classList.add("mainTd"),n.appendChild(o);let c=document.createElement("td");c.innerText=state.user.account.transactions[t].location,c.classList.add("mainTd"),n.appendChild(c);let s=document.createElement("td");s.innerText=state.user.account.transactions[t].amountString(),s.classList.add("mainTd"),n.appendChild(s),e.appendChild(n)}state.homePage.newData=!1},populateStats:function(){document.getElementById("balance").innerText="BALANCE: $"+state.user.account.balance;let e=new Date;document.getElementById("totalDiscretionary").innerText=state.user.account.discretionary(),document.getElementById("remainingDiscretionary").innerText=state.user.account.remainingDiscretionary(),document.getElementById("totalIncome").innerText=state.user.account.incomeTotal(),document.getElementById("totalBills").innerText=state.user.account.billTotal(),document.getElementById("title").innerText=state.user.account.name+" Account",document.getElementById("monthLabel").innerText=e.toLocaleDateString("en-US",{month:"long"});let t=document.getElementById("accountSelector");if(t.onchange=()=>{state.user.changeAccount(t.value)},state.user.accounts.length<=1)t.style.display="none";else{for(t.style.display="block";t.children.length>0;)t.removeChild(t.firstChild);let e=document.createElement("option");e.innerText="Accounts",e.selected=!0,e.disabled=!0,t.appendChild(e);for(let n=0;n<state.user.accounts.length;n++)if(state.user.accounts[n].id!==state.user.account.id){let e=document.createElement("option");e.innerText=state.user.accounts[n].name,e.value=state.user.accounts[n].id,t.appendChild(e)}}},populateIncome:function(){let e=document.getElementById("incomeBody");for(;e.children.length>0;)e.removeChild(e.firstChild);for(let t=0;t<state.user.account.income.length;t++){let n="No";for(let e=0;e<state.user.account.transactions.length;e++)state.user.account.transactions[e].category===state.user.account.income[t].name&&(n="Yes");let a=document.createElement("tr");e.appendChild(a);let o=document.createElement("td");o.innerText=state.user.account.income[t].name,o.classList.add("subTd"),a.appendChild(o);let c=document.createElement("td");c.innerText="$"+state.user.account.income[t].amount.toFixed(2),c.classList.add("subTd"),a.appendChild(c);let s=document.createElement("td");s.innerText=n,s.classList.add("subTd"),a.appendChild(s);let i=document.createElement("td");i.innerHTML='\n                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <polyline points="3 6 5 6 21 6"></polyline>\n                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n                </svg>\n            ',i.classList.add("subTd"),i.onclick=()=>{this.removeCategory(state.user.account.income[t],"income")},a.appendChild(i)}},populateBills:function(){let e=document.getElementById("billsBody");for(;e.children.length>0;)e.removeChild(e.firstChild);for(let t=0;t<state.user.account.bills.length;t++){let n="No";for(let e=0;e<state.user.account.transactions.length;e++)state.user.account.transactions[e].category===state.user.account.bills[t].name&&(n="Yes");let a=document.createElement("tr");e.appendChild(a);let o=document.createElement("td");o.innerText=state.user.account.bills[t].name,o.classList.add("subTd"),a.appendChild(o);let c=document.createElement("td");c.innerText="$"+state.user.account.bills[t].amount.toFixed(2),c.classList.add("subTd"),a.appendChild(c);let s=document.createElement("td");s.innerText=n,s.classList.add("subTd"),a.appendChild(s);let i=document.createElement("td");i.innerHTML='\n                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <polyline points="3 6 5 6 21 6"></polyline>\n                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n                </svg>\n            ',i.classList.add("subTd"),i.onclick=()=>{this.removeCategory(state.user.account.bills[t],"bills")},a.appendChild(i)}},removeCategory:function(e,t){fetch(`/finance/category/${state.user.account.id}/${e.name}/${t}`,{method:"delete"}).then(e=>e.json()).then(n=>{state.user.account.removeCategory(e.name,t),controller.openPage("homePage")}).catch(e=>{})},deleteAccount:function(){fetch("/finance/account/"+state.user.account.id,{method:"delete"}).then(e=>e.json()).then(e=>{for(let t=0;t<state.user.accounts.length;t++)state.user.accounts[t].id===state.user.account.id&&state.user.accounts.splice(t,1);state.user.account={},0===state.user.accounts.length?controller.openPage("createAccountPage"):state.user.changeAccount(state.user.accounts[0].id)}).catch(e=>{})}};var c={display:function(){document.getElementById("createAccountForm").onsubmit=()=>{this.submit()}},submit:function(){event.preventDefault(),fetch("/finance/account",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({name:document.getElementById("createAccountName").value})}).then(e=>e.json()).then(e=>{state.user.addAccount({id:e._id,name:e.name}),state.user.changeAccount(new n(e._id,e.name,e.bills,e.income,e.categories,0,[])),state.homePage.newData=!0,controller.openPage("homePage")}).catch(e=>{})}};var s={display:function(){if(document.getElementById("createTransactionForm").onsubmit=()=>{this.submit()},document.getElementById("createTransactionAccount"),!0===state.createTransactionPage.newCategories){let e=document.getElementById("createTransactionCategory");for(;e.children.length>0;)e.removeChild(e.firstChild);for(let t=0;t<state.user.account.bills.length;t++){let n=document.createElement("option");n.innerText=state.user.account.bills[t].name,n.value=state.user.account.bills[t].name,e.appendChild(n)}for(let t=0;t<state.user.account.income.length;t++){let n=document.createElement("option");n.innerText=state.user.account.income[t].name,n.value=state.user.account.income[t].name,e.appendChild(n)}for(let t=0;t<state.user.account.categories.length;t++){let n=document.createElement("option");n.innerText=state.user.account.categories[t],n.value=state.user.account.categories[t],e.appendChild(n)}state.createTransactionPage.newCategories}},submit:function(){event.preventDefault();let e={account:state.user.account.id,category:document.getElementById("createTransactionCategory").value,amount:document.getElementById("createTransactionAmount").value,location:document.getElementById("createTransactionLocation").value,date:document.getElementById("createTransactionDate").valueAsDate,note:document.getElementById("createTransactionNote").value};e.amount*=100,fetch("/finance/transaction",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{state.user.account.addTransaction(e),controller.openPage("homePage")}).catch(e=>{})}};var i={display:function(){document.getElementById("createCategoryForm").onsubmit=()=>{this.submit()}},submit:function(){event.preventDefault();let e={account:state.user.account.id,name:document.getElementById("createCategoryName").value};fetch("/finance/category",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then(e=>e.json()).then(t=>{state.user.account.addCategory(e.name),controller.openPage("homePage")}).catch(e=>{})}};var r={display:function(){document.getElementById("createBillForm").onsubmit=()=>{this.submit()}},submit:function(){event.preventDefault();let e={account:state.user.account.id,name:document.getElementById("createBillName").value,amount:document.getElementById("createBillAmount").value};e.amount=parseInt(100*e.amount),fetch("/finance/bill",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then(e=>e.json()).then(t=>{if("string"==typeof t)throw t;state.user.account.addBill(e.name,e.amount),controller.openPage("homePage")}).catch(e=>{})}};var l={display:function(){document.getElementById("createIncomeForm").onsubmit=()=>{this.submit()}},submit:function(){event.preventDefault();let e={account:state.user.account.id,name:document.getElementById("createIncomeName").value,amount:document.getElementById("createIncomeAmount").value};e.amount=parseInt(100*e.amount),fetch("/finance/income",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}).then(e=>e.json()).then(t=>{if("string"==typeof t)throw t;state.user.account.addIncome(e.name,e.amount),controller.openPage("homePage")}).catch(e=>{})}};var u={display:function(e){document.getElementById("transactionDate").innerText=e.dateString("long"),document.getElementById("transactionLocation").innerText=e.location,document.getElementById("transactionCategory").innerText=e.category,document.getElementById("transactionAmount").innerText=e.amountString(),document.getElementById("transactionNote").innerText=e.note,document.getElementById("deleteTransaction").onclick=()=>{this.delete(e)}},delete:function(e){fetch("/finance/transaction/"+e.id,{method:"delete"}).then(e=>e.json()).then(t=>{if("string"==typeof t)throw t;state.user.account.removeTransaction(e.id),controller.openPage("homePage")}).catch(e=>{})}};controller={openPage:function(e,t){let n=document.querySelectorAll(".page");for(let a=0;a<n.length;a++)n[a].style.display="none";switch(document.getElementById(e).style.display="flex",e){case"homePage":o.display();break;case"createAccountPage":c.display();break;case"createTransactionPage":s.display();break;case"createCategoryPage":i.display();break;case"createBillPage":r.display();break;case"createIncomePage":l.display();break;case"transactionPage":u.display(t)}}},state={user:null,homePage:{newData:!0},createTransactionPage:{newCategories:!0}},o.display()}();